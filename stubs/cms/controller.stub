<?php

namespace App\Http\Controllers;

use App\Models\{{ model }};
use App\Http\Requests\{{ model }}\StoreRequest;
use App\Http\Requests\{{ model }}\UpdateRequest;

class {{ model }}Controller extends Controller
{
    public function index()
    {
        {{ authorizeIndex }}

        $q = request('q');
        $query = \App\Models\{{ model }}::query();

        {{ softDeletesQuery }}

        {{ searchQuery }}

        $posts = $query->latest()->paginate()->withQueryString();

        return view('{{ kebabs }}.index', compact('posts', 'q'{{ fkCompactIndex }}));
    }

    public function create()
    {
        {{ authorizeCreate }}

        {{ fkListLoadsCreate }}

        return view('{{ kebabs }}.create'{{ fkCompactCreate }});
    }

    public function store(StoreRequest $request)
    {
        {{ authorizeStore }}

        $post= {{ model }}::create($request->validated());

        return redirect()->route('{{ routeNamePrefix }}{{ kebabs }}.index')
            ->with('success', '{{ model }} created');
    }

    public function show({{ model }} ${{ var }})
    {
        {{ authorizeShow }}

        return view('{{ kebabs }}.show', compact('{{ var }}'));
    }

    public function edit({{ model }} ${{ var }})
    {
        {{ authorizeEdit }}

        {{ fkListLoadsEdit }}

        return view('{{ kebabs }}.edit', compact('{{ var }}'{{ fkCompactEdit }}));
    }

    public function update(UpdateRequest $request, {{ model }} ${{ var }})
    {
        {{ authorizeUpdate }}

        ${{ var }}->update($request->validated());

        return redirect()->route('{{ routeNamePrefix }}{{ kebabs }}.index')
            ->with('success', '{{ model }} updated');
    }

    public function destroy({{ model }} ${{ var }})
    {
        {{ authorizeDestroy }}

        ${{ var }}->delete();

        return back()->with('success', '{{ model }} deleted');
    }

    public function restore($id)
    {
        $post = \App\Models\{{ model }}::onlyTrashed()->findOrFail($id);

        {{ authorizeRestore }}

        $post->restore();

        return back()->with('success', '{{ model }} restored');
    }
}
